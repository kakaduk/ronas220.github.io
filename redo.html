<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Интерактивная карта ямочного ремонта">
  <meta name="author" content="Администрация городского округа город Уфа Республики Башкортостан">
  <link rel="icon" href="/favicon.ico">

  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function (m, e, t, r, i, k, a) {
      m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
      m[i].l = 1 * new Date(); k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
    })
      (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    ym(52844527, "init", {
      clickmap: true,
      trackLinks: true,
      accurateTrackBounce: true,
      webvisor: true
    });
  </script>
  <noscript>
    <div><img src="https://mc.yandex.ru/watch/52844527" style="position:absolute; left:-9999px;" alt="" /></div>
  </noscript>
  <!-- /Yandex.Metrika counter -->

  <title>Интерактивная карта ямочного ремонта</title>

  <!-- CSS -->
  <link href="css/bootstrap.min.css?1552640776" rel="stylesheet">
  <link href="css/metisMenu.min.css" rel="stylesheet" type="text/css">
  <link href="css/sb-admin-2.css?1552640776" rel="stylesheet">
  <link href="css/template_styles.css" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- jQuery -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

  <!-- <script src="/bitrix/templates/yama_map/js/bootstrap.min.js"></script> -->

  <!-- Подключаем Яндекс.Карта -->
  <script src="https://api-maps.yandex.ru/2.1/?apikey=fea6d11d-324d-4800-8968-a6bbef134b29&lang=ru_RU"
    type="text/javascript"></script>
  <!--<script src="/bitrix/templates/yama_map/js/sb-admin-2.js?1552640776"></script>-->

  <!-- <script>window.jQuery || document.write('<script src="./bitrix/templates/yama_map/js/jquery.min.js"><\/script>')</script> -->

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

</head>

<body>

  <div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/"><i class="glyphicon glyphicon-map-marker fa-fw"></i>Ямочный ремонт</a>
      </div>
      <!-- /.navbar-header -->
      <div class="banners">
        <a href="http://neftcity.ru" class="navbar-left"><img class="img-responsive" src="images/neftcity.png"></a>
        <!--a href="https://onf.ru" class="navbar-left"><img class="img-responsive" src="images/onf.png"></a-->
      </div>
      <ul class="nav navbar-top-links navbar-right">
        <li>
          <a class="glyphicon glyphicon-home" data-toggle="modal" href="#LoginForm"> Личный кабинет</a>
        </li>
        <!-- /.dropdown -->
      </ul>
      <!-- /.navbar-top-links -->

      <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse collapse">
          <ul class="nav" id="side-menu">
            <li>
              <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse6532" aria-expanded="true"
                aria-controls="collapse6532"><i class="glyphicon glyphicon-road fa-fw"></i> Ямы города (2019 г.)</a>
              <ul id="collapse6532" aria-labelledby="heading6532" class="nav nav-second-level collapse in">
                <li>
                  <div class='checkbox'><img src='images/need17.png'
                      style='position: relative;width: 20px;left: -8px;bottom:1px;'><label><input type='checkbox'
                        id='80' name='Требуется ремонт' checked='checked'>Требуется ремонт</label></div>
                  <div class='checkbox'><img src='images/accept17.png'
                      style='position: relative;width: 20px;left: -8px;bottom:1px;'><label><input type='checkbox'
                        id='81' name='Заявка принята' checked='checked'>Заявка принята</label></div>
                  <div class='checkbox'><img src='images/ok17.png'
                      style='position: relative;width: 20px;left: -8px;bottom:1px;'><label><input type='checkbox'
                        id='82' name='Ремонт выполнен' checked='checked'>Ремонт выполнен</label></div>
                  <div class='checkbox'><img src='images/reject17.png'
                      style='position: relative;width: 20px;left: -8px;bottom:1px;'><label><input type='checkbox'
                        id='82' name='Заявка отклонена' checked='checked'>Заявка отклонена</label></div>

                  <!-- <div class="checkbox">
						<img src='/bitrix/templates/yama_map/images/road.png' style='position: relative;width: 20px;left: -8px;bottom:1px;'>
						<label><input type='checkbox' name='План' checked='checked'>Участки замены дорожного полотна в 2017 г.</label>
					</div> -->
                </li>
              </ul>
            </li>
          </ul>

        </div>
        <!-- /.sidebar-collapse -->
        <!--div class="container-fluid">
          <h4><b><u>Внимание</u>:</b></h4>
          <p>Информацию о статусе своей заявки Вы можете увидеть в <a href="/">личном кабинете</a></p>
        </div-->

        <br />

        <div class="col-lg-12 col-md-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="row">
                <div class="col-xs-2">
                  <i class="fa fa-th-list fa-3x"></i>
                </div>
                <div class="col-xs-10 text-right">
                  <div class="huge">0</div>
                  <div>Всего заявок</div>
                </div>
              </div>
            </div>
          </div>
        </div>




        <div class="col-lg-12 col-md-12">
          <div class="panel panel-green">
            <div class="panel-heading">
              <div class="row">
                <div class="col-xs-2">
                  <i class="fa fa-check fa-3x"></i>
                </div>
                <div class="col-xs-10 text-right">
                  <div class="huge">0</div>
                  <div>Ремонт выполнен</div>
                </div>
              </div>
            </div>
          </div>
        </div>




        <div class="col-lg-12 col-md-12">
          <div class="panel panel-yellow">
            <div class="panel-heading">
              <div class="row">
                <div class="col-xs-2">
                  <i class="fa fa-warning fa-3x"></i>
                </div>
                <div class="col-xs-10 text-right">
                  <div class="huge">0</div>
                  <div>Заявок принято</div>
                </div>
              </div>
            </div>
          </div>
        </div>




        <div class="col-lg-12 col-md-12">
          <div class="panel panel-red">
            <div class="panel-heading">
              <div class="row">
                <div class="col-xs-2">
                  <i class="fa fa-warning fa-3x"></i>
                </div>
                <div class="col-xs-10 text-right">
                  <div class="huge">0</div>
                  <div>Требуется ремонт</div>
                </div>
              </div>
            </div>
          </div>
        </div>




        <div class="col-lg-12 col-md-12">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <div class="row">
                <div class="col-xs-2">
                  <i class="fa fa-times fa-3x"></i>
                </div>
                <div class="col-xs-10 text-right">
                  <div class="huge">0</div>
                  <div>Заявок отклонено</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- /.navbar-static-side -->
    </nav>



    <!-- Modal -->
    <div class="modal fade" id="modalnewphoto" role="dialog">
      <!--div class="modal fade bs-example-modal-lg" id="modalnewphoto" tabindex="-1" role="dialog" aria-labelledby="AgreeModal"-->
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Сообщение</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">Фотография ямы
              <span class="starrequired">*</span>
              <input type="hidden" name="PROPERTY[1188][0]" value="">
              <input class="form-control" type="file" size="30" name="PROPERTY_FILE_1188_0" id="PROPERTY_FILE_1188_0"
                accept="image/*" required>
              <p class="help-block">Допустимые форматы фото: jpg, jpeg, gif, png. Размер файла не может превышать 8 Мб.
              </p>
              <p id="extError" style="display: none; color: red;"></p>
            </div>
          </div>
          <div class="modal-footer">
            <!--button type="submit" class="btn btn-success" data-dismiss="modal"><i class="glyphicon glyphicon-ok"></i> Добавить</button>
                <input type="button" value="Вход" onclick="CheckFields()" /-->
            <input class="btn btn-success" onclick=CheckFields() name="iblock_submit" value="Добавить">
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalvipolnen" role="dialog">
      <!--div class="modal fade bs-example-modal-lg" id="modalnewphoto" tabindex="-1" role="dialog" aria-labelledby="AgreeModal"-->
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Сообщение</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">Фотография ямы
              <span class="starrequired">*</span>
              <input type="hidden" name="PROPERTY[1188][0]" value="">
              <input class="form-control" type="file" size="30" name="PictureAfter" id="PictureAfter" accept="image/*"
                required>
              <p class="help-block">Допустимые форматы фото: jpg, jpeg, gif, png. Размер файла не может превышать 8 Мб.
              </p>
              <p id="extError" style="display: none; color: red;"></p>
            </div>
          </div>
          <div class="modal-footer">
            <!--button type="submit" class="btn btn-success" data-dismiss="modal"><i class="glyphicon glyphicon-ok"></i> Добавить</button>
                    <input type="button" value="Вход" onclick="CheckFields()" /-->
            <input class="btn btn-success" onclick=CheckVipolnen() name="iblock_submit" value="Добавить">
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="backupbasemodal" role="dialog">
      <!--div class="modal fade bs-example-modal-lg" id="modalnewphoto" tabindex="-1" role="dialog" aria-labelledby="AgreeModal"-->
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Создать резервную копию?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <!--button type="submit" class="btn btn-success" data-dismiss="modal"><i class="glyphicon glyphicon-ok"></i> Добавить</button>
                    <input type="button" value="Вход" onclick="CheckFields()" /-->
            <input class="btn btn-success" onclick=BackupBase() name="iblock_submit" value="Создать">
          </div>
        </div>
      </div>
    </div>

    <!-- Modal HTML -->
    <div id="LoginForm" class="modal fade">
      <div class="modal-dialog modal-login modal-sm">
        <div class="modal-content">
          <form action="javascript:;" onsubmit="chklg(this)">
            <div class="modal-header">
              <h4 class="modal-title">Войти</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label>Имя пользователя</label>
                <input type="text" name="login" class="form-control" required="required">
              </div>
              <div class="form-group">
                <div class="clearfix">
                  <label>Пароль</label>
                  <a href="#" class="pull-right text-muted"><small>Забыли?</small></a>
                </div>

                <input type="password" name="password" class="form-control" required="required">
                <p id="extErrorlogin" style="display: none; color: red;"></p>
              </div>
            </div>
            <div class="modal-footer">
              <label class="checkbox-inline pull-left"><input type="checkbox"> Запомнить меня</label>
              <input type="submit" class="btn btn-primary pull-right" value="Войти">
            </div>
          </form>
        </div>
      </div>
    </div>
    <!--Modal ends here--->

    <!-- Modal -->
    <div class="modal fade" id="needmodal" role="dialog">
      <!--div class="modal fade bs-example-modal-lg" id="modalnewphoto" tabindex="-1" role="dialog" aria-labelledby="AgreeModal"-->
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Измение статуса</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Изменить на: Требуется ремонт?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
            <button type="button" onclick=ChangeToNeed() class="btn btn-primary" id="needbutton"
              data-dismiss="modal">Да</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal HTML -->
    <div id="modalreject" class="modal fade" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Изменить на: Отклонить заявку?</h4>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Комментарий</label>
              <input type="text" id="komment" class="form-control" autofocus>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="rejectbutton" onclick="sendreject()"
              data-dismiss="modal">Изменить</button>
            <!--input type="submit" class="btn btn-primary pull-right" value="Изменить" data-dismiss="modal" -->
          </div>
        </div>
      </div>
    </div>
    <!--Modal ends here--->

    <div id="page-wrapper" style="padding: 0;">
      <script src="js/data.js?v=1552640776" type="text/javascript"></script>
      <!--Подключение карты Яндекс -->
      <div id="map">
        <div id="loadingDiv" class="loadingdivmobile" style="display: none; left: 50%;"></div>
      </div>
    </div>
    <a href="#" class="scrollup">Scroll</a>

    <!-- Custom Theme JavaScript -->
    <script src="js/sb-admin-2.js?1552640776"></script>
    <style>
      #loadingDiv {
        position: absolute;
        z-index: 1;
        left: 40%;
        top: 48%;
        margin-top: -50px;
      }

      #loadingDiv,
      #loadingDiv :after {
        border-radius: 50%;
        width: 10em;
        height: 10em;
      }

      #loadingDiv {
        /* margin: 60px auto; */
        font-size: 10px;
        /* position: relative; */
        text-indent: -9999em;
        border-top: 1.1em solid rgba(0, 0, 0, 0.2);
        border-right: 1.1em solid rgba(0, 0, 0, 0.2);
        border-bottom: 1.1em solid rgba(0, 0, 0, 0.2);
        border-left: 1.1em solid #f8f8f8;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation: load8 1.1s infinite linear;
        animation: load8 1.1s infinite linear;
      }

      @-webkit-keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }

        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }

      @keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }

        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
    </style>
    <!-- Bootstrap core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <!-- FancyBox JS -->
    <script type="text/javascript" src="js/jquery.fancybox.js"></script>
    <!-- Add mousewheel plugin (this is optional) -->
    <script type="text/javascript" src="js/jquery.mousewheel-3.0.6.pack.js"></script>
    <!-- Add fancyBox main JS and CSS files -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox.css?1552640776" media="screen" />
    <!-- Add Button helper (this is optional) -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox-buttons.css?v=1.0.5" />
    <script type="text/javascript" src="js/jquery.fancybox-buttons.js?v=1.0.5"></script>
    <!-- Add Thumbnail helper (this is optional) -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox-thumbs.css?v=1.0.7" />
    <script type="text/javascript" src="js/jquery.fancybox-thumbs.js?v=1.0.7"></script>
    <!-- Add Media helper (this is optional) -->
    <script type="text/javascript" src="js/jquery.fancybox-media.js?v=1.0.6"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-storage.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCOvHxFLYsbHclUwuEo1sfA77b8HGW6VxU",
        authDomain: "neftekamsk-71979.firebaseapp.com",
        databaseURL: "https://neftekamsk-71979.firebaseio.com",
        projectId: "neftekamsk-71979",
        storageBucket: "neftekamsk-71979.appspot.com",
        messagingSenderId: "1091543827699"
      };
      firebase.initializeApp(config);
      var database = firebase.database();
      var storage = firebase.storage();

      var collection = database.ref('neftekamsk');
      loaddata();
      function loaddata() {
        $('#loadingDiv').show();
        collection.once("value", function (data) {
          var source = data.val();
          var object_ok = [];
          var object_accept = [];
          var object_need = [];
          var object_reject = [];
          var hintContent;
          var key;
          var i_ok = 0;
          var i_accept = 0;
          var i_need = 0;
          var i_reject = 0;
          for (var key in source) {

            var record = source[key];
            record.id = key;
            record.rr = ("bar", { myType: "test", count: 40 });
            hintContent = record.properties.balloonContent;
            switch (record.status) {
              case "need":
                record.options.preset = "islands#redCircleIcon";
                record.properties.balloonContentBody = "<b>Ф.И.О.:</b><p>" + record.properties.balloonContentHeader +
                  "</p><b>Местоположение ямы:</b><p>" + record.properties.balloonContent +
                  "</p><b>Описание:</b><p>" + record.properties.hintContent +
                  "</p><b>Статус:</b><p>Требуется ремонт</p><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"before_photos('" + key +
                  "')\"><i class=\"glyphicon glyphicon-picture\"></i> Фото ямы</button>"
                if (typeof record.text != "undefined" || record.text == "") { record.properties.balloonContentBody = record.properties.balloonContentBody + "</p><b>Комментарий:</b><p>" + record.text }
                break;
              case "ok":
                record.options.preset = "islands#greenGlyphCircleIcon";
                record.options.iconGlyph = "ok"
                record.properties.balloonContentBody = "<b>Ф.И.О.:</b><p>" + record.properties.balloonContentHeader +
                  "</p><b>Местоположение ямы:</b><p>" + record.properties.balloonContent +
                  "</p><b>Описание:</b><p>" + record.properties.hintContent +
                  "</p><b>Статус:</b><p>Ремонт выполнен</p><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"before_photos('" + key +
                  "')\"><i class=\"glyphicon glyphicon-picture\"></i> Фото ямы</button><button type=\"button\" class=\"btn btn-success btn-sm\" onclick=\"after_photos('" + key +
                  "')\"><i class=\"glyphicon glyphicon-picture\"><\/i> Ремонт выполнен<\/button>"
                if (typeof record.text != "undefined" && record.text != "") { record.properties.balloonContentBody = record.properties.balloonContentBody + "</p><b>Комментарий:</b><p>" + record.text }
                break;
              case "reject":
                record.options.preset = "islands#blueGlyphCircleIcon";
                record.options.iconGlyph = "remove"
                record.properties.balloonContentBody = "<b>Ф.И.О.:</b><p>" + record.properties.balloonContentHeader +
                  "</p><b>Местоположение ямы:</b><p>" + record.properties.balloonContent +
                  "</p><b>Описание:</b><p>" + record.properties.hintContent +
                  "</p><b>Статус:</b><p>Заявка отклонена</p><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"before_photos('" + key +
                  "')\"><i class=\"glyphicon glyphicon-picture\"></i> Фото ямы</button>"
                if (!(typeof record.text == "undefined" || record.text == "")) { record.properties.balloonContentBody = record.properties.balloonContentBody + "</p><b>Комментарий:</b><p>" + record.text }
                break;
              default:
                record.options.preset = "islands#yellowCircleIcon";
                record.properties.balloonContentBody = "<b>Ф.И.О.:</b><p>" + record.properties.balloonContentHeader +
                  "</p><b>Местоположение ямы:</b><p>" + record.properties.balloonContent +
                  "</p><b>Описание:</b><p>" + record.properties.hintContent +
                  "</p><b>Статус:</b><p>Заявка принята</p><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"before_photos('" + key +
                  "')\"><i class=\"glyphicon glyphicon-picture\"></i> Фото ямы</button>"
                if (typeof record.text != "undefined" || record.text == "") { record.properties.balloonContentBody = record.properties.balloonContentBody + "</p><b>Комментарий:</b><p>" + record.text }
            }
            if (an == true) {
              record.properties.balloonContentFooter = "</p><b>Редактирование заявки:</b><p>" +
                //"</button><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"new_photo('" + key +
                //"')\"><i class=\"glyphicon glyphicon-picture\"><\/i> Заменить фото<\/button>" +
                "</button><button type=\"button\" class=\"btn btn-success btn-sm\" onclick=\"vipolnen('" + key +
                "')\"> Ремонт выполнен<\/button>" +
                "</button><button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"nuzenremont('" + key +
                "')\"> Требуется ремонт<\/button>" +
                "</button><button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"rejectfunc('" + key +
                "')\"> Заявка отклонена<\/button>" +
                "</button><button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"deletepoint('" + key +
                "')\"> Удалить<\/button>"
            }
            record.properties.balloonContentHeader = "Заявка";
            record.properties.hintContent = hintContent
            switch (record.status) {
              case "need":
                i_need = i_need + 1;
                object_need.push(record);
                break;
              case "ok":
                i_ok = i_ok + 1;
                object_ok.push(record);
                break;
              case "reject":
                i_reject = i_reject + 1;
                object_reject.push(record);
                break;
              default:
                i_accept = i_accept + 1;
                object_accept.push(record);
            }
          }
          //var myJsonString = JSON.stringify(object_accept);
          objectManager_accept.removeAll();
          objectManager_accept.add(JSON.stringify(object_accept));
          objectManager_ok.removeAll();
          objectManager_ok.add(JSON.stringify(object_ok));
          objectManager_need.removeAll();
          objectManager_need.add(JSON.stringify(object_need));
          objectManager_reject.removeAll();
          objectManager_reject.add(JSON.stringify(object_reject));

          document.querySelector('#wrapper > nav > div.navbar-default.sidebar > div:nth-child(3) > div > div > div > div.col-xs-10.text-right > div.huge').innerHTML = i_ok + i_need + i_accept + i_reject;
          document.querySelector('#wrapper > nav > div.navbar-default.sidebar > div:nth-child(5) > div > div > div > div.col-xs-10.text-right > div.huge').innerHTML = i_accept;
          document.querySelector('#wrapper > nav > div.navbar-default.sidebar > div:nth-child(4) > div > div > div > div.col-xs-10.text-right > div.huge').innerHTML = i_ok;
          document.querySelector('#wrapper > nav > div.navbar-default.sidebar > div:nth-child(6) > div > div > div > div.col-xs-10.text-right > div.huge').innerHTML = i_need;
          document.querySelector('#wrapper > nav > div.navbar-default.sidebar > div:nth-child(7) > div > div > div > div.col-xs-10.text-right > div.huge').innerHTML = i_reject;
          $('#loadingDiv').hide();
        });
      };
      $(document).ready(function () {

        $(window).scroll(function () {
          if ($(this).scrollTop() > 100) {
            $('.scrollup').fadeIn();
          } else {
            $('.scrollup').fadeOut();
          }
        });

        $('.scrollup').click(function () {
          $("html, body").animate({
            scrollTop: 0
          }, 600);
          return false;
        });

      });
    </script>
    <script>
      function CheckFields() {
        var checkpassword = false;
        //................ // тут идет набор проверок

        if (validateForm()) {
          //document.getElementById("modalForm").submit();
          savepicture();
          $('#modalnewphoto').modal("hide");
        }
      }

      function CheckVipolnen() {
        var checkpassword = false;
        //................ // тут идет набор проверок

        if (validateFormVipolnen()) {
          //document.getElementById("modalForm").submit();
          savepictureafter();
          $('#modalvipolnen').modal("hide");

        }
      }
      var an = false;
      function chklg(dat) {
        var dt = dat.login.value;
        var ty = dat.password.value
        var ref = firebase.database().ref('login/' + dt)
        ref.on("value", function (snapshots) {
          snapshots.forEach(function (record) {
            if (ty == record.val()) {
              ref.off();
              document.getElementById("extErrorlogin").innerHTML = "";
              $('#LoginForm').modal("hide");
              an = true
              loaddata();
              return true
            };
            //data.push({ value: value });
            ref.off();
            document.getElementById("extErrorlogin").style.display = "block";
            document.getElementById("extErrorlogin").innerHTML = "Неверные имя и пароль.";
            an = false
            return false
          });
        });
      }
      function sendreject() {
        firebase.database().ref('neftekamsk/' + key).update({
          status: "reject",
          text: document.getElementById('komment').value
        });
        $('#modalreject').hide();
        loaddata();
        return false
      };

      function BackupBase() {
        $('#loadingDiv').show();
        var collect = database.ref('');
        collect.once("value", function (data) {
          var source = data.val();
          var result = [];
          var hintContent;
          var i = 0;
          for (var key in source) {
          }

          $('#loadingDiv').hide();
        });
        $('#backupbasemodal').modal("hide");
      }

      function validateForm() {
        var extlist = "GIF,JPEG,JPG,PNG";
        var file = document.getElementById('PROPERTY_FILE_1188_0').files[0];
        file_name = file.name;
        file_size = file.size;
        a = file_name.split('.');
        ext = a[a.length - 1].toUpperCase();
        if (extlist.indexOf(ext) == "-1") {
          document.getElementById("extError").style.display = "block";
          document.getElementById("extError").innerHTML = "Используется недопустимое расширение файла.";
          return false;
        } else if (file_size > 8388608) {
          document.getElementById("extError").style.display = "block";
          document.getElementById("extError").innerHTML = "Размер файла превышает 8 Мб";
          return false;
        }
        return true;
      }

      function validateFormVipolnen() {
        var extlist = "GIF,JPEG,JPG,PNG";
        var file = document.getElementById('PictureAfter').files[0];
        file_name = file.name;
        file_size = file.size;
        a = file_name.split('.');
        ext = a[a.length - 1].toUpperCase();
        if (extlist.indexOf(ext) == "-1") {
          document.getElementById("extError").style.display = "block";
          document.getElementById("extError").innerHTML = "Используется недопустимое расширение файла.";
          return false;
        } else if (file_size > 8388608) {
          document.getElementById("extError").style.display = "block";
          document.getElementById("extError").innerHTML = "Размер файла превышает 8 Мб";
          return false;
        }
        return true;
      }

      function before_photos(id) {
        id = id.replace(":", "%3A").replace(":", "%3A")
        $.fancybox({
          /*autoScale: true,
          transitionIn: 'elastic',
          transitionOut: 'elastic',
          speedIn: 500,
          speedOut: 300,
          autoDimensions: true,
          centerOnScroll: true,*/
          loop: false,
          href: "https://firebasestorage.googleapis.com/v0/b/neftekamsk-71979.appspot.com/o/neftekamsk%2F" + id + "-before.jpg?alt=media"
        });
      }

      function after_photos(id) {
        id = id.replace(":", "%3A").replace(":", "%3A")
        $.fancybox({
          /*autoScale: true,
          transitionIn: 'elastic',
          transitionOut: 'elastic',
          speedIn: 500,
          speedOut: 300,
          autoDimensions: true,
          centerOnScroll: true,*/
          loop: false,
          href: "https://firebasestorage.googleapis.com/v0/b/neftekamsk-71979.appspot.com/o/neftekamsk%2F" + id + "-after.jpg?alt=media"
        });
      }

      function new_photo(id) {
        key = id;
        //$('#modalnewphoto').appendTo("body").modal('show');
        $("#modalnewphoto").modal();
        if (!$("#modalnewphoto").parent().is('body'))
          $("#modalnewphoto").appendTo("body");
      }

      function rejectfunc(id) {
        key = id;
        $("#modalreject").modal();
        if (!$("#modalreject").parent().is('body'))
          $("#modalreject").appendTo("body");
      }

      function vipolnen(id) {
        key = id;
        //$('#modalnewphoto').appendTo("body").modal('show');

        $("#modalvipolnen").modal();
        if (!$("#modalvipolnen").parent().is('body'))
          $("#modalvipolnen").appendTo("body");
      }

      function deletepoint(id) {
        var qn = confirm("Удалить заявку?");
        if (qn == true) {
          var uploadTask = storage.ref().child('neftekamsk/' + id + '-before.jpg');
          uploadTask.delete().then(function () {
            // File deleted successfully
          }).catch(function (error) {
            // Uh-oh, an error occurred!
          });
          //uploadTask.delete().addOnSuccessListener()
          uploadTask = storage.ref().child('neftekamsk/' + id + '-after.jpg');
          uploadTask.delete().then(function () {
            // File deleted successfully
          }).catch(function (error) {
            // Uh-oh, an error occurred!
          });
          firebase.database().ref('neftekamsk/' + id).remove();
          loaddata();
        }
      }

      function nuzenremont(id) {
        key = id;
        $('#needmodal').modal();
        if (!$("#needmodal").parent().is('body'))
          $("#needmodal").appendTo("body");
      }

      function ChangeToNeed() {
        firebase.database().ref('neftekamsk/' + key).update({
          status: "need"
        });
        $('#needmodal').hide();
        loaddata();
      }

      function savepicture() { // отправку формы делать тут
        $('#loadingDiv').show();
        var file = document.getElementById('PROPERTY_FILE_1188_0').files[0];
        var metadata = {
          contentType: 'image/jpeg'
        };
        var storageRef = storage.ref();
        var uploadTask = storageRef.child('neftekamsk/' + key + '-before.jpg').put(file, metadata);
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
          function (snapshot) {
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED: // or 'paused'
                console.log('Upload is paused');
                break;
              case firebase.storage.TaskState.RUNNING: // or 'running'
                console.log('Upload is running');
                break;
            }
          }, function (error) {
            switch (error.code) {
              case 'storage/unauthorized':
                // User doesn't have permission to access the object
                break;
              case 'storage/canceled':
                // User canceled the upload
                break;
              //...
              case 'storage/unknown':
                // Unknown error occurred, inspect error.serverResponse
                break;
            }
          }, function () {
            // Upload completed successfully, now we can get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
              console.log('File available at', downloadURL);
              $('#loadingDiv').hide();
            });
          });
        return false
      }

      function savepictureafter() { // отправку формы делать тут
        $('#loadingDiv').show();
        var file = document.getElementById('PictureAfter').files[0];
        var metadata = {
          contentType: 'image/jpeg'
        };
        var storageRef = storage.ref();
        var uploadTask = storageRef.child('neftekamsk/' + key + '-after.jpg').put(file, metadata);
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
          function (snapshot) {
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED: // or 'paused'
                console.log('Upload is paused');
                break;
              case firebase.storage.TaskState.RUNNING: // or 'running'
                console.log('Upload is running');
                break;
            }
          }, function (error) {
            switch (error.code) {
              case 'storage/unauthorized':
                // User doesn't have permission to access the object
                break;
              case 'storage/canceled':
                // User canceled the upload
                break;
              //...
              case 'storage/unknown':
                // Unknown error occurred, inspect error.serverResponse
                break;
            }
          }, function () {
            // Upload completed successfully, now we can get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
              console.log('File available at', downloadURL);
              //Меняем статус
              //firebase.database().goOnline();
              firebase.database().ref('neftekamsk/' + key).update({
                status: "ok"
              });
              //var commentsRef =firebase.database().ref('neftekamsk/' + key + "/status")
              //commentsRef.onDisconnect().set("ok");
              //commentsRef.off();
              //firebase.database().goOffline();
              $('#loadingDiv').hide();
            });
          });
        setTimeout(function () {
          loaddata();
        }, 3000);
        return false
      }
      //auth
      $('.form_auth .bx-auth-serv-icons a').removeAttr('onclick');
      var $ok = $('#bx_auth_serv_formOdnoklassniki a').attr('onclick'), $vk = $('#bx_auth_serv_formVKontakte a').attr('onclick');
      $('.form_auth .odnoklassniki').attr('onclick', $ok);
      $('.form_auth .vkontakte').attr('onclick', $vk);
	//auth
    </script>

  </div>

</body>

</html>