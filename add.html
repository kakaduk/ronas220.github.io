<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Интерактивная карта ямочного ремонта">
    <meta name="author" content="Администрация городского округа город Уфа Республики Башкортостан">
    <link rel="icon" href="/favicon.ico">
 
	  <!-- Yandex.Metrika counter -->
	  <script type="text/javascript" >
		 (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
	         m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
                 (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
                 ym(52844527, "init", {
                 clickmap:true,
                 trackLinks:true,
                 accurateTrackBounce:true,
                 webvisor:true
                 });
          </script>
          <noscript><div><img src="https://mc.yandex.ru/watch/52844527" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
          <!-- /Yandex.Metrika counter -->  
	  
    <title>Добавление ямы</title>

    <!-- CSS -->
    <link href="css/bootstrap.min.css?1552838717" rel="stylesheet">
    <link href="css/metisMenu.min.css" rel="stylesheet" type="text/css">
    <link href="css/sb-admin-2.css?1552838717" rel="stylesheet">
    <link href="css/template_styles.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    
    <!-- <script src="/bitrix/templates/yama_map/js/bootstrap.min.js"></script> -->
    
    <!-- Подключаем Яндекс.Карта -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=fea6d11d-324d-4800-8968-a6bbef134b29&lang=ru_RU" type="text/javascript"></script>
    <!--<script src="/bitrix/templates/yama_map/js/sb-admin-2.js?1552838717"></script>-->

    <!-- <script>window.jQuery || document.write('<script src="./bitrix/templates/yama_map/js/jquery.min.js"><\/script>')</script> -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/core.min.css?14533561562854" type="text/css"  rel="stylesheet" />
<script type="text/javascript">if(!window.BX)window.BX={message:function(mess){if(typeof mess=='object') for(var i in mess) BX.message[i]=mess[i]; return true;}};</script>
<script type="text/javascript">(window.BX||top.BX).message({'JS_CORE_LOADING':'Загрузка...','JS_CORE_NO_DATA':'- Нет данных -','JS_CORE_WINDOW_CLOSE':'Закрыть','JS_CORE_WINDOW_EXPAND':'Развернуть','JS_CORE_WINDOW_NARROW':'Свернуть в окно','JS_CORE_WINDOW_SAVE':'Сохранить','JS_CORE_WINDOW_CANCEL':'Отменить','JS_CORE_H':'ч','JS_CORE_M':'м','JS_CORE_S':'с','JSADM_AI_HIDE_EXTRA':'Скрыть лишние','JSADM_AI_ALL_NOTIF':'Показать все','JSADM_AUTH_REQ':'Требуется авторизация!','JS_CORE_WINDOW_AUTH':'Войти','JS_CORE_IMAGE_FULL':'Полный размер'});</script>
<script type="text/javascript">(window.BX||top.BX).message({'PULL_OLD_REVISION':'Для продолжения корректной работы с сайтом необходимо перезагрузить страницу.'});</script>
<script type="text/javascript">(window.BX||top.BX).message({'LANGUAGE_ID':'ru','FORMAT_DATE':'DD.MM.YYYY','FORMAT_DATETIME':'DD.MM.YYYY HH:MI:SS','COOKIE_PREFIX':'UFACITY','SERVER_TZ_OFFSET':'18000','SITE_ID':'ru','SITE_DIR':'/','USER_ID':'113599','SERVER_TIME':'1552838717','USER_TZ_OFFSET':'0','USER_TZ_AUTO':'Y','bitrix_sessid':'0463940b5c91e7e6cc1024da96533f49'});</script>

    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div id="wrapper">
      <!-- Navigation -->
      <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
          <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/"><i class="glyphicon glyphicon-map-marker fa-fw"></i>Ямочный ремонт</a>
          </div>
          <!-- /.navbar-header -->
          <div class="banners">
            <a href="http://neftcity.ru" class="navbar-left"><img class="img-responsive" src="images/neftcity.png"></a>
            <!--a href="https://onf.ru" class="navbar-left"><img class="img-responsive" src="images/onf.png"></a-->
          </div>
          <ul class="nav navbar-top-links navbar-right">
            <li>
              <a href="/"><i class="glyphicon glyphicon-home"></i> Личный кабинет</a>
            </li>
                                          <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-user"></i> Пользователь <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="?logout=YES"><i class="fa fa-fw fa-power-off"></i> Выйти</a>
                        </li>
                    </ul>
                  </li>
                          <!-- /.dropdown -->
          </ul>
          <!-- /.navbar-top-links -->  <div class="navbar-default sidebar" role="navigation">
    <div class="sidebar-nav navbar-collapse collapse">
      <ul class="nav" id="side-menu">
        <li>
          <a  class="active" href="add.html"><i class="glyphicon glyphicon-plus fa-fw"></i> Новая яма</a>
        </li>
      </ul>
    </div>
    <!-- /.sidebar-collapse -->
    <div class="container-fluid">
      <h4><b><u>Внимание</u>:</b></h4>
      <p>Принимаются заявки по адресам в пределах города Нефтекамска.</p>
      <p>Адреса за пределами Нефтекамска будут отклоняться.</p>
    </div>
  </div>
<!-- /.navbar-static-side -->
</nav>

  <div id="page-wrapper">
      
<script>
  var extlist = "GIF,JPEG,JPG,PNG";

function validateForm() {
    var file = document.getElementById('PROPERTY_FILE_1188_0').files[0];
    file_name = file.name;
    file_size = file.size;
    a = file_name.split('.');
    ext = a[a.length-1].toUpperCase();  
    var x = document.forms["iblock_add"]["PROPERTY[1183][0]"].value;
    if (x == "") {
        $('#myModal').modal();
        return false;
       
    } else if (extlist.indexOf(ext) == "-1") {
        document.getElementById("extError").style.display = "block";
        document.getElementById("extError").innerHTML = "Используется недопустимое расширение файла.";
        return false;
    } else if (file_size > 8388608) {
        document.getElementById("extError").style.display = "block";
        document.getElementById("extError").innerHTML = "Размер файла превышает 8 Мб";
     return false;
    }
}
</script>

<div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Ошибка</h4>
      </div>
      <div class="modal-body">
        <div id="error" class="alert alert-danger" role="alert">
      Поставьте отметку на карте в пределах городского округа город Нефтекамск.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

<script src="js/district.js?v=1552838717" type="text/javascript"></script>

<div class="modal fade bs-example-modal-sm" id="errTerritory" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Ошибка</h4>
      </div>
      <div class="modal-body">
        <div id="error" class="alert alert-danger" role="alert">
          Заявки принимаются по адресам в пределах городского округа город Нефтекамск. Поставьте отметку на территории города.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade bs-example-modal-sm" id="info29roads" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Информация</h4>
      </div>
      <div class="modal-body">
        <div id="error" class="alert alert-info" role="alert">
          На данном участке дороги в весенне-летний период 2018 года будет полностью произведена замена дорожного полотна.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

  <div class="col-lg-12">
    <h1 class="page-header">Добавление ямы</h1>
  </div>
    <div class="col-lg-5">
    <div id="error" style="display: none;" class="alert alert-danger" role="alert">
      Поставьте отметку на карте
    </div>
      <label for="map">Укажите местоположение ямы *</label>
      <div id="map" style="height: 400px;"></div>
    </div>
<div class="col-lg-7">


  <!----form name="iblock_add" action="" method="post" enctype="multipart/form-data" onsubmit="return validateForm()"-->
    <form name="iblock_add">
  <input type="hidden" name="sessid" id="sessid" value="0463940b5c91e7e6cc1024da96533f49" />  
    



<div class="form-group">Ф.И.О
  <span class="starrequired">*</span>
  <input class="form-control" type="text" name="PROPERTY[NAME][0]" size="25" value="" required id="FIO">
</div>

<div class="form-group">Местоположение ямы
  <span class="starrequired">*</span>
  <textarea class="form-control" cols="30" rows="5" name="PROPERTY[PREVIEW_TEXT][0]" required id="Mesto"></textarea>
</div>

<div class="form-group">Описание
  <textarea class="form-control" cols="30" rows="5" name="PROPERTY[DETAIL_TEXT][0]" id="Opis"></textarea>
</div>

<div class="form-group">Фотография ямы
  <span class="starrequired">*</span>                                                        
  <input type="hidden" name="PROPERTY[1188][0]" value="">
   <input class="form-control" type="file" size="30" name="PROPERTY_FILE_1188_0" id="PROPERTY_FILE_1188_0" accept="image/*" required>
   <p class="help-block">Допустимые форматы фото: jpg, jpeg, gif, png. Размер файла не может превышать 8 Мб.</p>
   <p id="extError" style="display: none; color: red;"></p>
</div>

<div class="form-group">
  <input class="form-control" id="LONGITUDE" type="hidden" name="PROPERTY[1184][0]" size="25" value="" required="">
</div>

<input type="hidden" name="PROPERTY[IBLOCK_SECTION]" value="6532">
<input type="hidden" name="PROPERTY[1185][0]" value="381">
<input type="hidden" id="district" name="PROPERTY[1192][0]" value="">

<div class="form-group">
  <input class="form-control" id="LATITUDE" type="hidden" name="PROPERTY[1183][0]" size="25" value="" required>
</div>

<div class="checkbox" style="padding: 0;">
  <label>
    <input type="checkbox" value="" required>
      Я согласен с <a href="" data-toggle="modal" data-target="#AgreeModal">правилами сервиса "Интерактивная карта ямочного ремонта"</a>
  </label>
</div>

<input class="btn btn-success" type="submit" name="iblock_submit" value="Добавить">

  </form>
</div>

<div class="modal fade bs-example-modal-lg" id="AgreeModal" tabindex="-1" role="dialog" aria-labelledby="AgreeModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel"><b>Правила сервиса "Интерактивная карта ямочного ремонта"</b></h4>
      </div>
      <div class="modal-body">
        <ul>
          <li>Сервис создан для получения оперативной информации о существующих проблемах дорожного покрытия на улицах города Нефтеккамска. Данные используются городскими службами для корректировки планов ямочного ремонта.</li>
          <li>Принимаются заявки на ремонт асфальтового покрытия  на дорогах в пределах города Нефтекамска.</li>
          <li>Поля, отмеченные в форме «*»,  являются обязательными для заполнения.</li>
          <li>К заявке обязательно должна быть прикреплена актуальная фотография, на которой видно место повреждения дорожного полотна. При фотографировании предпочтительно использовать ракурсы, позволяющие более точно определить местоположение ямы (желательна привязка к объектам).</li>
          <li>В описании необходимо указать место, адрес повреждения дороги.</li>
          <li>В одной заявке указывается один адрес.</li>
          <li>Сообщения, содержащие недостоверную информацию, являющиеся выражением эмоций и не несущие информативной нагрузки отклоняются.</li>
          <li>Каждый участник, оставляющий заявку на сервисе, соглашается с настоящими Правилами и обязуется их соблюдать. Заявки, не соответствующие Правилам, отклоняются администраторами.</li>
        </ul>
        <h4><b>Запрещается:</b></h4>
        <ul>
          <li>Размещение на карте заведомо ложной информации.</li>
          <li>Использование нецензурной лексики, оскорблений, угроз, информации, противоречащей законодательству РФ.</li>
        </ul>
        <p>Подобная информация будет удалена модератором без объяснения причин.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>  
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="modalSend" tabindex="-1" role="dialog" aria-labelledby="AgreeModal">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Сообщение</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <ul>
                <li>Ваше сообщение принято.</li>
                <li>После рассмотрения администратором будет опубликовано на сайте.</li>
            </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"data-dismiss="modal">Закрыть</button>
        </div>
      </div>
    </div>
  </div>

</div>
    <!-- Bootstrap core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <!-- FancyBox JS -->
    <script type="text/javascript" src="js/jquery.fancybox.js"></script>
    <!-- Add mousewheel plugin (this is optional) -->
    <script type="text/javascript" src="js/jquery.mousewheel-3.0.6.pack.js"></script>
    <!-- Add fancyBox main JS and CSS files -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox.css?1552838717" media="screen" />
    <!-- Add Button helper (this is optional) -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox-buttons.css?v=1.0.5" />
    <script type="text/javascript" src="js/jquery.fancybox-buttons.js?v=1.0.5"></script>
    <!-- Add Thumbnail helper (this is optional) -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fancybox-thumbs.css?v=1.0.7" />
    <script type="text/javascript" src="js/jquery.fancybox-thumbs.js?v=1.0.7"></script>
    <!-- Add Media helper (this is optional) -->
    <script type="text/javascript" src="js/jquery.fancybox-media.js?v=1.0.6"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-database.js"></script>
    <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyCOvHxFLYsbHclUwuEo1sfA77b8HGW6VxU",
          authDomain: "neftekamsk-71979.firebaseapp.com",
          databaseURL: "https://neftekamsk-71979.firebaseio.com",
          projectId: "neftekamsk-71979",
          storageBucket: "neftekamsk-71979.appspot.com",
          messagingSenderId: "1091543827699"
        };
        firebase.initializeApp(config);
        var database = firebase.database();
      </script>
    <script>
function validateForm() { // отправку формы делать тут

  firebase.database().ref('neftekamsk/' + Math.random().toString(36).substr(2, 9)).set({
    
                type: "Feature",
                id: "315341",
                geometry: {
                    type: "Point",
                    coordinates: [
                        "54.7627",
                        "55.9965"
                    ]
                },
                properties: {
                    iconContent: "<p class=\"fa fa-exclamation\"><\/p>",
                    balloonContentHeader: document.getElementById("FIO").value,
                    balloonContent: document.getElementById("Mesto").value,
                    hintContent: document.getElementById("Opis").value
                    },
                options: {
                    preset: "islands#redCircleIcon"
                }
            
  });
  $('#modalSend').modal();
  //window.opener.location.reload();
  //document.location.href = "index.html";
    return false
    
}
$('#modalSend').on('hidden.bs.modal', function() {
  document.location.href = "index.html";
})

document.forms[0].onsubmit = validateForm

    $(document).ready(function () {

        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) {
                $('.scrollup').fadeIn();
            } else {
                $('.scrollup').fadeOut();
            }
        });

        $('.scrollup').click(function () {
            $("html, body").animate({
                scrollTop: 0
            }, 600);
            return false;
        });
    });
    </script>
   <script>
    function before_photos(id,iblock_id) {
      $.ajax({
        url: '/doroga/photos.php',
        method: 'POST',
        data: {element_id: id, iblock_id: iblock_id, type: "before"},                    
        type: 'post',
        dataType: 'json',
        success: function(data){
          //$( "#links" ).append('<p>asdasd</p>');
          var i;
          var photos = [];
          for (i = 0; i < data.length; i++) {
              photos[i] = "http://ufacity.info" + data[i].photo_src; 
          }

      $.fancybox(photos, {loop: false});

         // var gallery = blueimp.Gallery(photos);
             } 
        }); 
    }

    function after_photos(id,iblock_id) {
      $.ajax({
        url: '/doroga/photos.php',
        method: 'POST',
        data: {element_id: id, iblock_id: iblock_id, type: "after"},                    
        type: 'post',
        dataType: 'json',
        success: function(data){
          var i;
          var photos = [];
          for (i = 0; i < data.length; i++) {
              photos[i] = "http://ufacity.info" + data[i].photo_src; 
          }

          $.fancybox(photos, {loop: false});
          //var gallery = blueimp.Gallery(photos);
             } 
        }); 
    } 
	//auth
	$('.form_auth .bx-auth-serv-icons a').removeAttr('onclick');
	var $ok=$('#bx_auth_serv_formOdnoklassniki a').attr('onclick'),$vk=$('#bx_auth_serv_formVKontakte a').attr('onclick');
	$('.form_auth .odnoklassniki').attr('onclick',$ok);
	$('.form_auth .vkontakte').attr('onclick',$vk);
	//auth
   </script>

</div>
 
</body>
</html>
